MCP（Model Context Protocol）は、AI エージェントが統一されたインターフェースを通じて外部ツール、API、データソースにアクセスできるオープン標準です。REST サービスの OpenAPI と同様に、ツールの発見とアクセスを標準化します。MCP は、ビジネスニーズの変化に応じて AI ツールの更新や置き換えを簡素化することで、AI システムの構成可能性と俊敏性を向上させます。

# 主要な利点

- **相互運用性** – 最小限のカスタムコードで、任意のベンダーの MCP 対応ツールに AI エージェントを接続できます。
- **セキュリティフック** – サインイン、権限、アクティビティロギングを統合します。
- **再利用性** – 一度構築すれば、プロジェクト、クラウド、ランタイム間で再利用できます。
- **運用の簡素化** – 単一のコントラクトにより、ボイラープレートとメンテナンスを削減します。

# アーキテクチャ

```
┌─────────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Azure AI Agent    │    │   MCP Client    │    │   MCP Server    │
│   (main.py)         │◄──►│ (mcp_client.py) │◄──►│ (mcp_server_sales_analysis.py) │
│                     │    └─────────────────┘    └─────────────────┘
│ ┌─────────────────┐ │                                   │
│ │ Azure AI        │ │                                   ▼
│ │ Agents Service  │ │                           ┌─────────────────┐
│ │ + Streaming     │ │                           │ Azure Database  │
│ │                 │ │                           │ for PostgreSQL  │
│ └─────────────────┘ │                           │       +         │
└─────────────────────┘                           │    pgvector     │
         │                                        └─────────────────┘
         ▼                                                │
┌─────────────────────┐                           ┌─────────────────┐
│ Azure OpenAI        │                           │ 8 Normalized    │
│ Model Deployment    │                           │ Tables with     │
│ (GPT-4, etc.)       │                           │ Performance     │
└─────────────────────┘                           │ Indexes         │
                                                  └─────────────────┘
```

# 仕組み

MCP は、AI エージェントと外部リソースとのやり取りにクライアント・サーバーモデルを使用します：

- **MCP Host:** AI エージェントを実行するランタイムまたはプラットフォーム（例：Azure AI Foundry Agent Service）。
- **MCP Client:** AI エージェントのツール呼び出しを MCP リクエストに変換する SDK。
- **MCP Server:** ツールを登録し、リクエストを実行し、JSON 結果を返します。認証、認可、ログをサポートします。

### MCP Server のコンポーネント

- **Resources:** データベース、API、ファイルストアなどのデータソース。
- **Tools:** オンデマンドで実行される登録された関数または API。
- **Prompts（オプション）:** 再利用のためのバージョン管理されたテンプレート。
- **Policies（オプション）:** 制限と安全性チェック（レート、深度、認証）。

### MCP トランスポート

- **HTTP/HTTPS:** ストリーミングサポート付きの標準 Web プロトコル。
- **stdio:** ランタイムを共有する軽量なローカルまたはコンテナ化されたトランスポート。

このワークショップでは、ローカル MCP 通信に stdio を使用します。本番デプロイメントでは、スケーラビリティとセキュリティのために HTTPS を使用します。

# 使用例

このワークショップでは、MCP サーバーは Azure AI Agent を Zava の売上データにリンクします。製品、売上、在庫について質問すると：

1. AI エージェントが MCP Server リクエストを生成します。
2. MCP Server は：
    - 正確なクエリのためのスキーマ情報を提供します。
    - SQL クエリを実行し、構造化データを返します。
    - 時間に敏感なレポートのための時刻サービスを提供します。

これにより、Zava の売上運営への効率的なリアルタイムインサイトが可能になります。

*Translated using GitHub Copilot and GPT-4o.*
