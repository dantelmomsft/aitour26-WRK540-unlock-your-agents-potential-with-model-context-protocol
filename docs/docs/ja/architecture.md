## 主要技術概要

- **Azure AI Foundry エージェントサービス**
  LLM 駆動エージェントをホスト。ツール（MCP サーバーを含む）をオーケストレーション。コンテキスト、コードインタープリター、トークンストリーミングを管理。認証、ログ記録、スケーリングを提供。
- **MCP サーバー**
  MCP（Model Context Protocol）は、LLM に外部ツール、API、データへの統一インターフェースを提供するオープン標準です。ツール発見を標準化し（REST 用の OpenAPI のように）、ニーズの変化に応じてツールを簡単に更新または交換できるようにすることで、組み合わせ性を向上させます。
- **PostgreSQL + pgvector**
  リレーショナルデータと埋め込みを保存。リレーショナル（SQL）とセマンティック（ベクトル）の両方のクエリ（pgvector 経由）をサポートし、SQL と RLS によって管理されます。

**総合して:** エージェントサービスはユーザーの意図をルーティング。MCP サーバーはそれらをツール/SQL 呼び出しに変換。PostgreSQL+pgvector はセマンティックおよび分析的質問に回答します。

## アーキテクチャ（高レベル）

```plaintext
┌─────────────────────┐                         ┌─────────────────┐
│   Zava Agent App    │       stdio/https       │   MCP Server    │
│   (app.py)          │◄───────────────────────►│ (sales_analysis)│
│                     │      MCP Transports     └─────────────────┘
│ ┌─────────────────┐ │                                 │
│ │ Azure AI        │ │                                 ▼
│ │ Agents Service  │ │                         ┌─────────────────┐
│ │ + Streaming     │ │                         │ Azure Database  │
│ │                 │ │                         │ for PostgreSQL  │
│ └─────────────────┘ │                         │   + pgvector    │
└─────────────────────┘                         └─────────────────┘
         │                                              |
         ▼                                              ▼
┌─────────────────────┐                         ┌─────────────────┐
│ Azure OpenAI        │                         │ Zava Sales      │
│ Model Deployments   │                         │ Database with   │
│ - gpt-4o-mini       │                         │ Semantic Search │
│ - text-embedding-3- │                         └─────────────────┘
│   small             │
└─────────────────────┘
```

## MCP サーバーの主要利点

- **相互運用性** – 最小限のカスタムコードで AI エージェントを任意のベンダーの MCP 対応ツールに接続。
- **セキュリティフック** – サインイン、権限、アクティビティログを統合。
- **再利用性** – 一度構築すれば、プロジェクト、クラウド、ランタイム間で再利用。
- **運用の簡素性** – 単一の契約により、定型コードとメンテナンスを削減。

## 実証されたベストプラクティス

- **非同期 API:** エージェントサービスと PostgreSQL は非同期 API を使用。FastAPI/ASP.NET/Streamlit に最適。
- **トークンストリーミング:** UI における体感レイテンシを改善。
- **観測可能性:** 組み込みトレーシングとメトリクスがモニタリングと最適化をサポート。
- **データベースセキュリティ:** PostgreSQL は制限されたエージェント権限と行レベルセキュリティ（RLS）で保護され、エージェントを認可されたデータのみに制限。
- **コードインタープリター:** [Azure AI エージェントサービス コードインタープリター](https://learn.microsoft.com/azure/ai-services/agents/how-to/tools/code-interpreter?view=azure-python-preview&tabs=python&pivots=overview){:target="_blank"} は、LLM 生成コードを**サンドボックス**環境でオンデマンド実行し、エージェントのスコープを超えたアクションを防止。

## 拡張性

ワークショップパターンは、Foundry でデータベース + エージェント指示を更新することで（例：カスタマーサポート）適応可能です。

*GitHub Copilot を使用して翻訳されました。*
